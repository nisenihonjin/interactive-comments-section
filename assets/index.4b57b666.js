var Y=Object.defineProperty;var D=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var U=(t,e,n)=>e in t?Y(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,E=(t,e)=>{for(var n in e||(e={}))z.call(e,n)&&U(t,n,e[n]);if(D)for(var n of D(e))H.call(e,n)&&U(t,n,e[n]);return t};import{r as J,a as K,c as $,t as I,b as k,o as f,d as g,e as a,u as p,w as O,v as R,f as w,g as W,h as Z,F as M,i as Q,n as X,T as P,j as ee,k as A,l as te,m as C,p as ne,q as T,s as re,x as se}from"./vendor.a7b1d9a4.js";const oe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}};oe();const ce="modulepreload",L={},ae="/interactive-comments-section/",ie=function(e,n){return!n||n.length===0?e():Promise.all(n.map(o=>{if(o=`${ae}${o}`,o in L)return;L[o]=!0;const r=o.endsWith(".css"),s=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${s}`))return;const i=document.createElement("link");if(i.rel=r?"stylesheet":ce,r||(i.as="script",i.crossOrigin=""),i.href=o,document.head.appendChild(i),r)return new Promise((u,m)=>{i.addEventListener("load",u),i.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e())},q="interactive-comments-section-main",l=J({actionType:null,activeId:null,comments:[],currentUser:{},isModalActive:!1});function ue(t){const e=Date.now();return t.map(n=>(n.createdAt=e-n.createdAt,n))}async function le(){const t=await ie(()=>import("./data.c3f9c3e6.js"),[]);return{currentUser:t.currentUser,comments:[...ue(t.comments)]}}function V(t){const e=[],n=l.comments.filter(o=>o.parentId===t);return n.length&&(e.push(t),n.forEach(o=>{e.concat(V(o.id))})),e}const de="deleting",B="editting",N="replying";function x(){const t=$(()=>[...l.comments].sort((c,d)=>c.createdAt-d.createdAt)),e=$(()=>Object.keys(l.currentUser).length>0);function n(c,d=null){const _=u();l.comments.push({id:_,parentId:d,content:c,createdAt:Date.now(),score:0,user:E({},l.currentUser)}),v()}function o(c,d){const _=l.comments.find(G=>G.id===c),S=_.score+d;_.score=S>=0?S:0,v()}function r(c){const d=new Set(V(c.value));l.comments=l.comments.filter(_=>_.id!==c.value&&!d.has(_.parentId)),v()}async function s(){let c=JSON.parse(localStorage.getItem(q));c||(c=await le()),l.currentUser=c.currentUser,l.comments=c.comments}function i(c){return l.comments.some(d=>d.parentId===c)}function u(){return l.comments.reduce((d,_)=>d>_.id?d:_.id,0)+1}function m(c){return t.value.filter(d=>d.parentId===c)}function v(){const c={currentUser:l.currentUser,comments:l.comments};localStorage.setItem(q,JSON.stringify(c))}function y(c,d){l.activeId=c,l.actionType=d}function b(c){l.isModalActive=c}function h(c,d){l.comments=l.comments.map(_=>(_.id===d&&(_.content=c),_)),v()}return{state:K(l),commentsByTimestamp:t,isDataLoaded:e,addComment:n,changeScore:o,deleteComment:r,loadData:s,hasReplies:i,nextId:u,replies:m,saveData:v,setActive:y,toggleModal:b,updateComment:h}}const me={class:"add-comment"},pe={class:"avatar"},fe=["srcset"],ve=["srcset"],_e=["src","alt"],j={props:{buttonText:{type:String,required:!0},parentId:{type:Number,default:null}},setup(t){const e=t,{state:n,addComment:o,setActive:r}=x(),{activeId:s,actionType:i,currentUser:u}=I(n),m=k("");$(()=>s.value===e.parentId&&i.value===N);const v=function(){o(m.value,e.parentId),m.value="",r(null,null)};return(y,b)=>(f(),g("div",me,[a("picture",pe,[a("source",{type:"image/webp",srcset:p(u).image.webp},null,8,fe),a("source",{type:"image/png",srcset:p(u).image.png},null,8,ve),a("img",{src:p(u).image.png,alt:`${p(u).username}'s avatar`},null,8,_e)]),O(a("textarea",{class:"input",placeholder:"Add a comment...","onUpdate:modelValue":b[0]||(b[0]=h=>m.value=h)},null,512),[[R,m.value]]),a("button",{class:"button button-content",onClick:v},w(t.buttonText),1)]))}},ge=a("div",{class:"modal-header"},"Delete comment",-1),ye=a("div",{class:"modal-body"},"Are you sure your want to delete this comment? This will remove the comment and can't be undone.",-1),he={setup(t){const{state:e,deleteComment:n,toggleModal:o,setActive:r}=x(),{activeId:s,isModalActive:i}=I(e),u=k(null);W(()=>{Z(()=>{i.value?u.value.showModal():u.value.close()})});const m=function(){r(null,null),o(!1)},v=function(){m()},y=function(){n(s),m()};return(b,h)=>(f(),g("dialog",{class:"modal",id:"modal",ref_key:"modal",ref:u},[ge,ye,a("div",{class:"modal-confirm"},[a("button",{class:"button button-confirm button-confirm-cancel",onClick:v},"No, cancel"),a("button",{class:"button button-confirm button-confirm-delete",onClick:y},"Yes, delete")])],512))}},be={class:"comment-actions"},$e={props:{id:{type:Number,required:!0,validator(t){return/^[1-9][0-9]*$/.test(t)}},user:{type:Object,required:!0,validator(t){return t.hasOwnProperty("image")&&t.hasOwnProperty("username")}}},setup(t){const e=t,{state:n,isDataLoaded:o,setActive:r,toggleModal:s}=x(),{currentUser:i}=I(n),u=$(()=>o?e.user.username===i.value.username:!1),m=function(){r(e.id,de),s(!0)};return(v,y)=>(f(),g("div",be,[p(u)?(f(),g(M,{key:0},[a("button",{class:"comment-action comment-action-delete",onClick:m},"Delete"),a("button",{class:"comment-action comment-action-edit",onClick:y[0]||(y[0]=b=>p(r)(e.id,p(B)))},"Edit")],64)):(f(),g("button",{key:1,class:"comment-action comment-action-reply",onClick:y[1]||(y[1]=b=>p(r)(e.id,p(N)))},"Reply"))]))}},xe={key:0,class:"comment-content updating"},Ae=["innerHTML"],Ie={props:{id:{type:Number,required:!0,validator(t){return/^[1-9][0-9]*$/.test(t)}},content:{type:String,required:!0}},setup(t){const e=t,{state:n,setActive:o,updateComment:r}=x(),{activeId:s,actionType:i}=I(n),u=k(e.content),m=$(()=>s.value===e.id&&i.value===B),v=$(()=>{const b=/(@[A-Za-z0-9_]+)/g,h='<span class="mention">$1</span>';return u.value.replace(b,h)}),y=function(){r(u.value,e.id),o(null,null)};return(b,h)=>p(m)?(f(),g("div",xe,[O(a("textarea",{class:"input",placeholder:"Add a comment...","onUpdate:modelValue":h[0]||(h[0]=c=>u.value=c)},null,512),[[R,u.value]]),a("button",{class:"button button-content",onClick:h[1]||(h[1]=c=>y())},"Update")])):(f(),g("div",{key:1,class:"comment-content",innerHTML:p(v)},null,8,Ae))}},we={class:"score"},ke={class:"score-number"},Ce={props:{id:{type:Number,required:!0,validator(t){return/^[1-9][0-9]*$/.test(t)}},score:{type:Number,required:!0,validator(t){return/^[0-9]+$/.test(t)}}},setup(t){const e=t,{changeScore:n}=x(),o=function(){n(e.id,1)},r=function(){n(e.id,-1)};return(s,i)=>(f(),g("div",we,[a("button",{class:"score-add",onClick:o},"+"),a("div",ke,w(e.score),1),a("button",{class:"score-remove",onClick:r},"\u2212")]))}},Te={props:{activator:{type:[Boolean,Function],required:!0}},setup(t){const e=t;return(n,o)=>(f(),g("div",{class:X(["transitioner",{active:e.activator}])},[Q(n.$slots,"default")],2))}};P.addDefaultLocale(ee);const Ne=new P("en-US");function Se(){function t(e){return Ne.format(e)}return{humanReadableTime:t}}const De={class:"comment"},Ue={class:"comment-container"},Ee={class:"comment-details"},Le={class:"avatar avatar-small"},qe=["srcset"],Oe=["srcset"],Re=["src","alt"],Me={class:"username"},Pe={key:0,class:"self"},Ve={class:"created-at"},Be={props:{id:{type:Number,required:!0,validator(t){return/^[1-9][0-9]*$/.test(t)}},user:{type:Object,required:!0,validator(t){return t.hasOwnProperty("image")&&t.hasOwnProperty("username")}},createdAt:{type:Number,required:!0,validator(t){return/^[1-9][0-9]{12}$/.test(t)}},score:{type:Number,required:!0,validator(t){return/^[0-9]+$/.test(t)}},content:{type:String,required:!0}},setup(t){const e=t,{state:n,isDataLoaded:o,hasReplies:r}=x(),{activeId:s,actionType:i,currentUser:u}=I(n);k(e.content);const{humanReadableTime:m}=Se(),v=$(()=>o?e.user.username===u.value.username:!1),y=$(()=>s.value===e.id&&i.value===N);return(b,h)=>(f(),g("article",De,[a("div",Ue,[A(Ce,{id:e.id,score:e.score},null,8,["id","score"]),a("div",Ee,[a("picture",Le,[a("source",{type:"image/webp",srcset:e.user.image.webp},null,8,qe),a("source",{type:"image/png",srcset:e.user.image.png},null,8,Oe),a("img",{src:e.user.image.png,alt:`${e.user.username}'s avatar`},null,8,Re)]),a("div",Me,[te(w(e.user.username)+" ",1),p(v)?(f(),g("span",Pe,"you")):C("",!0)]),a("div",Ve,w(p(m)(t.createdAt)),1)]),A($e,{id:e.id,user:e.user},null,8,["id","user"]),A(Ie,{id:e.id,content:e.content},null,8,["id","content"])]),A(Te,{activator:p(y)},{default:ne(()=>[A(j,{buttonText:"Reply",parentId:t.id},null,8,["parentId"])]),_:1},8,["activator"]),p(r)(e.id)?(f(),T(F,{key:0,parentId:e.id},null,8,["parentId"])):C("",!0)]))}},je={class:"comment-list"},F={props:{parentId:{type:Number,default:null,validator(t){return t===null||/^[1-9][0-9]*$/.test(t)}}},setup(t){const e=t,{replies:n}=x();return(o,r)=>(f(),g("div",je,[(f(!0),g(M,null,re(p(n)(e.parentId),s=>(f(),T(Be,{key:s.id,id:s.id,user:s.user,createdAt:s.createdAt,score:s.score,content:s.content},null,8,["id","user","createdAt","score","content"]))),128))]))}};const Fe={setup(t){const{isDataLoaded:e,loadData:n}=x();return n(),(o,r)=>(f(),g("main",null,[A(F),p(e)?(f(),T(j,{key:0,buttonText:"Send"})):C("",!0),A(he)]))}};se(Fe).mount("#app");
